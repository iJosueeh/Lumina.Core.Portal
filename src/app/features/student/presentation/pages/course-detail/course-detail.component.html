<!-- Course Detail Page - Unified View -->
<div class="min-h-screen bg-gradient-to-br from-[#0a1628] via-[#0f1e33] to-[#1a2942]">
  <!-- Loading State -->
  @if (isLoadingCourse()) {
    <div class="flex items-center justify-center min-h-screen">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500 mb-4"></div>
        <p class="text-white text-lg">Cargando curso...</p>
        <p class="text-gray-400 text-sm mt-2">üöÄ TanStack Query optimizando carga...</p>
        @if (isLoadingAny()) {
          <p class="text-gray-500 text-xs mt-1">Obteniendo datos en paralelo</p>
        }
      </div>
    </div>
  }

  <!-- Error State -->
  @if (hasError()) {
    <div class="flex items-center justify-center min-h-screen">
      <div class="bg-red-900/20 border border-red-500 rounded-lg p-6 max-w-md">
        <p class="text-red-400 text-lg font-semibold mb-2">Error al cargar el curso</p>
        <p class="text-red-300 text-sm">{{ errorMessage() }}</p>
        <button 
          (click)="courseQuery.refetch()"
          class="mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded transition"
        >
          Reintentar
        </button>
      </div>
    </div>
  }
  
  @if (course(); as courseData) {
    <!-- Hero Header -->
    <header class="relative h-64 bg-gradient-to-r from-gray-900 to-gray-800 overflow-hidden">
      <!-- ... contenido del header ... -->
      <img
        [src]="courseData.coverImage"
        alt="Course cover"
        class="absolute inset-0 w-full h-full object-cover opacity-30"
      />
      <div class="relative h-full flex items-end p-8">
        <div class="flex items-center gap-4 text-white">
          <button class="p-2 hover:bg-white/10 rounded-lg transition-colors" aria-label="Volver">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15.75 19.5L8.25 12l7.5-7.5"
              />
            </svg>
          </button>
          <div>
            <div class="flex items-center gap-2 mb-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342M6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5zm0 0v-3.675A55.378 55.378 0 0112 8.443m-7.007 11.55A5.981 5.981 0 006.75 15.75v-1.5"
                />
              </svg>
              <span class="text-sm">{{ courseData.semester }}</span>
            </div>
            <h1 class="text-3xl font-bold mb-2">{{ courseData.title }}</h1>
            <div class="flex items-center gap-3">
              <img [src]="courseData.instructor.avatar" alt="Instructor" class="w-8 h-8 rounded-full" />
              <div class="text-sm">
                <p class="font-semibold">Prof. {{ courseData.instructor.name }}</p>
                <p class="text-gray-300">{{ courseData.instructor.title }}</p>
              </div>
              <button
                (click)="continueCurrentLesson()"
                class="ml-4 px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-teal-500/20 transition-all duration-300 flex items-center gap-2"
              >
                <span>Continuar Lecci√≥n</span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  class="w-4 h-4"
                >
                  <path
                    fill-rule="evenodd"
                    d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content Grid -->
    <main class="container mx-auto px-4 py-8 grid grid-cols-12 gap-8">
      <!-- Left Column: Content (8 cols) -->
      <div class="col-span-12 lg:col-span-8 space-y-8">
        <!-- Tabs Navigation -->
        <nav class="flex items-center gap-2 p-1 bg-navy-800/50 rounded-xl overflow-x-auto">
          @for (tab of tabs; track tab.id) {
            <button
              (click)="setTab(tab.id)"
              [class.bg-teal-500]="activeTab === tab.id"
              [class.text-white]="activeTab === tab.id"
              [class.text-gray-400]="activeTab !== tab.id"
              [class.hover:bg-white/5]="activeTab !== tab.id"
              class="flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap"
            >
              <!-- Icon Injection -->
              @switch (tab.icon) {
                @case ('document') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
                    />
                  </svg>
                }
                @case ('book') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"
                    />
                  </svg>
                }
                @case ('folder') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"
                    />
                  </svg>
                }
                @case ('chart') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"
                    />
                  </svg>
                }
              }
              {{ tab.label }}
            </button>
          }
        </nav>

        <!-- Tab Content -->
        @switch (activeTab) {
          @case ('description') {
            <!-- Description Tab -->
            <div class="space-y-6 fade-in">
              <section class="bg-navy-800/50 p-6 rounded-xl border border-navy-700">
                <h2 class="text-xl font-bold text-white mb-4">Acerca del curso</h2>
                <div 
                  class="text-gray-300 leading-relaxed course-description-content" 
                  [innerHTML]="courseData.description"
                ></div>
              </section>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Learning Objectives -->
                <section class="bg-navy-800/50 p-6 rounded-xl border border-navy-700">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5 text-teal-400"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"
                      />
                    </svg>
                    Lo que aprender√°s
                  </h3>
                  <ul class="space-y-3">
                    @for (item of courseData.learningObjectives; track $index) {
                      <li class="flex items-start gap-3 text-gray-300">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="w-5 h-5 text-teal-500 mt-0.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4.5 12.75l6 6 9-13.5"
                          />
                        </svg>
                        <span>{{ item }}</span>
                      </li>
                    }
                  </ul>
                </section>

                <!-- Requirements -->
                <section class="bg-navy-800/50 p-6 rounded-xl border border-navy-700">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5 text-orange-400"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"
                      />
                    </svg>
                    Requisitos
                  </h3>
                  <ul class="space-y-3">
                    @for (req of courseData.requirements; track $index) {
                      <li class="flex items-start gap-3 text-gray-300">
                        <span class="w-1.5 h-1.5 rounded-full bg-orange-400 mt-2.5"></span>
                        <span>{{ req }}</span>
                      </li>
                    }
                  </ul>
                </section>
              </div>

              <!-- Horarios del Curso -->
              @if (courseData.schedule && courseData.schedule.length > 0) {
                <section class="bg-navy-800/50 p-6 rounded-xl border border-navy-700">
                  <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5 text-teal-400"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
                      />
                    </svg>
                    Horarios de Clase
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    @for (sch of courseData.schedule; track sch.id) {
                      <div class="p-4 bg-navy-700/50 rounded-lg border border-navy-600 hover:border-teal-500/50 transition-colors">
                        <div class="flex items-start gap-3">
                          <!-- Icono de modalidad -->
                          <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-teal-500/10 flex items-center justify-center">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke-width="1.5"
                              stroke="currentColor"
                              class="w-6 h-6 text-teal-400"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                [attr.d]="getModalityIcon(sch.modalidad)"
                              />
                            </svg>
                          </div>
                          <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                              <h4 class="font-semibold text-white">{{ sch.diaSemana }}</h4>
                              <span 
                                class="px-2 py-0.5 text-xs rounded-full"
                                [class.bg-green-500/20]="sch.modalidad === 'Presencial'"
                                [class.text-green-400]="sch.modalidad === 'Presencial'"
                                [class.bg-blue-500/20]="sch.modalidad === 'Virtual'"
                                [class.text-blue-400]="sch.modalidad === 'Virtual'"
                                [class.bg-purple-500/20]="sch.modalidad === 'H√≠brido'"
                                [class.text-purple-400]="sch.modalidad === 'H√≠brido'"
                              >
                                {{ sch.modalidad }}
                              </span>
                            </div>
                            <p class="text-gray-300 text-sm mb-1">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                class="w-4 h-4 inline-block mr-1"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"
                                />
                              </svg>
                              {{ sch.horaInicio }} - {{ sch.horaFin }}
                            </p>
                            <p class="text-gray-400 text-sm">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                class="w-4 h-4 inline-block mr-1"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                                />
                              </svg>
                              {{ sch.aula }}
                            </p>
                            @if (sch.tipo) {
                              <span class="text-xs text-teal-400 mt-1 inline-block">{{ sch.tipo }}</span>
                            }
                            @if (sch.enlaceReunion && sch.modalidad !== 'Presencial') {
                              <a 
                                [href]="sch.enlaceReunion" 
                                target="_blank" 
                                class="text-xs text-blue-400 hover:text-blue-300 mt-1 flex items-center gap-1"
                              >
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  fill="none"
                                  viewBox="0 0 24 24"
                                  stroke-width="1.5"
                                  stroke="currentColor"
                                  class="w-3 h-3"
                                >
                                  <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"
                                  />
                                </svg>
                                Unirse a la sesi√≥n
                              </a>
                            }
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </section>
              }
            </div>
          }
          @case ('content') {
            <!-- Content Tab (Modules) -->
            <div class="space-y-4 fade-in">
              @for (module of courseData.modules; track module.id) {
                <article class="gradient-border-card card-3d group">
                  <!-- Module Header (Clickable) -->
                  <button
                    (click)="toggleModule(module)"
                    class="w-full p-6 flex items-center gap-4 text-left hover:bg-white/5 transition-colors rounded-t-xl"
                    [attr.aria-expanded]="expandedModules.has(module.id)"
                    [attr.aria-controls]="'module-content-' + module.id"
                  >
                    <!-- Module Number -->
                    <div
                      class="w-10 h-10 rounded-full bg-navy-700 flex items-center justify-center text-teal-400 font-bold border border-navy-600 group-hover:border-teal-500/50 transition-colors"
                    >
                      {{ $index + 1 }}
                    </div>

                    <div class="flex-1">
                      <h3 class="text-white font-semibold flex items-center gap-3">
                        {{ module.title }}
                        @if (module.id === 'm1') {
                          <span
                            class="px-2 py-0.5 rounded text-xs font-medium bg-green-500/10 text-green-400"
                            >Completado</span
                          >
                        }
                      </h3>
                      <p class="text-sm text-gray-400 mt-1">{{ module.duration }} ‚Ä¢ 3 lecciones</p>
                    </div>

                    <!-- Chevron Icon -->
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-5 h-5 text-gray-400 transition-transform duration-300"
                      [class.rotate-180]="expandedModules.has(module.id)"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M19.5 8.25l-7.5 7.5-7.5-7.5"
                      />
                    </svg>
                  </button>

                  <!-- Lessons List (Collapsible) -->
                  @if (expandedModules.has(module.id)) {
                    <div
                      [id]="'module-content-' + module.id"
                      class="border-t border-navy-700/50 bg-black/20"
                    >
                      <ul class="divide-y divide-navy-700/30">
                        @for (lesson of module.lessons; track lesson.id) {
                          <li>
                            <div
                              class="p-4 flex items-center gap-4 hover:bg-white/5 transition-colors group/lesson cursor-pointer"
                              (click)="startLesson(lesson)"
                            >
                              <!-- Status Icon -->
                              <div class="flex-shrink-0">
                                @if (lesson.isCompleted) {
                                  <svg
                                    class="w-6 h-6 text-teal-500"
                                    fill="currentColor"
                                    viewBox="0 0 24 24"
                                  >
                                    <path
                                      fill-rule="evenodd"
                                      d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                                      clip-rule="evenodd"
                                    />
                                  </svg>
                                } @else if (lesson.isLocked) {
                                  <svg
                                    class="w-6 h-6 text-gray-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                  >
                                    <path
                                      stroke-linecap="round"
                                      stroke-linejoin="round"
                                      stroke-width="1.5"
                                      d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"
                                    />
                                  </svg>
                                } @else {
                                  <div
                                    class="w-6 h-6 rounded-full border-2 border-gray-500 group-hover/lesson:border-teal-400 transition-colors"
                                  ></div>
                                }
                              </div>

                              <div class="flex-1 min-w-0">
                                <p
                                  class="text-gray-200 group-hover/lesson:text-teal-400 transition-colors font-medium truncate"
                                >
                                  {{ lesson.title }}
                                </p>
                                <div class="flex items-center gap-3 text-xs text-gray-500 mt-1">
                                  <span class="flex items-center gap-1">
                                    <!-- Dynamic Icon based on type -->
                                    <svg
                                      class="w-4 h-4"
                                      fill="none"
                                      stroke="currentColor"
                                      viewBox="0 0 24 24"
                                    >
                                      <!-- Use getTypeIcon/getLessonIcon -->
                                      <!-- Simplified for this view, assumes video by default or logic in TS -->
                                      <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="1.5"
                                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                      />
                                      <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="1.5"
                                        d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z"
                                      />
                                    </svg>
                                    {{ lesson.duration }}
                                  </span>
                                </div>

                                <!-- Materials (inline with lesson) -->
                                @if (hasRelatedMaterials(lesson)) {
                                  <div class="mt-3 pl-4 border-l-2 border-teal-500/20 space-y-2">
                                    @for (
                                      material of getMaterialsForLesson(lesson.id);
                                      track material.id
                                    ) {
                                      <div
                                        class="flex items-center justify-between group/material py-2 px-3 rounded hover:bg-navy-600/50 transition-colors"
                                      >
                                        <div class="flex items-center gap-2 flex-1 min-w-0">
                                          <span class="text-lg flex-shrink-0">
                                            <svg
                                              class="w-5 h-5"
                                              fill="none"
                                              viewBox="0 0 24 24"
                                              stroke="currentColor"
                                            >
                                              <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="1.5"
                                                [attr.d]="getMaterialIcon(material.type)"
                                              />
                                            </svg>
                                          </span>
                                          <span class="text-sm text-gray-300 truncate">{{
                                            material.title
                                          }}</span>
                                          @if (material.fileSize) {
                                            <span class="text-xs text-gray-500 ml-2"
                                              >({{ material.fileSize }})</span
                                            >
                                          }
                                        </div>
                                        <button
                                          (click)="downloadMaterial(material)"
                                          class="opacity-0 group-hover/material:opacity-100 transition-opacity text-teal-400 hover:text-teal-300 text-sm font-semibold flex items-center gap-1"
                                          [attr.aria-label]="'Descargar ' + material.title"
                                        >
                                          <svg
                                            class="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                          >
                                            <path
                                              stroke-linecap="round"
                                              stroke-linejoin="round"
                                              stroke-width="1.5"
                                              d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                                            />
                                          </svg>
                                          Descargar
                                        </button>
                                      </div>
                                    }
                                  </div>
                                }
                              </div>
                            </div>
                          </li>
                        }
                      </ul>
                    </div>
                  }
                </article>
              }
            </div>
          }

          @case ('evaluations') {
            <!-- Evaluations Tab -->
            <div class="space-y-6 fade-in">
              <!-- Summary Cards -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Total Evaluaciones -->
                <div
                  class="bg-navy-800/50 p-6 rounded-xl border border-navy-700 relative overflow-hidden"
                >
                  <div class="absolute top-0 right-0 p-4 opacity-10">
                    <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"
                      />
                    </svg>
                  </div>
                  <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-2">
                    Total Evaluaciones
                  </h3>
                  <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-bold text-white">{{ quizSummaries().length }}</span>
                  </div>
                  <p class="text-sm text-gray-400 mt-2">Disponibles en el curso</p>
                </div>

                <!-- Completadas -->
                <div
                  class="bg-navy-800/50 p-6 rounded-xl border border-navy-700 relative overflow-hidden"
                >
                  <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-2">
                    Completadas
                  </h3>
                  <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-bold text-green-500">{{ completedQuizzesCount() }}</span>
                    <span class="text-gray-500">/ {{ quizSummaries().length }}</span>
                  </div>
                  <p class="text-sm text-gray-400 mt-2">
                    {{ completionPercentage().toFixed(0) }}% de progreso
                  </p>
                </div>

                <!-- Promedio -->
                <div
                  class="bg-navy-800/50 p-6 rounded-xl border border-navy-700 relative overflow-hidden"
                >
                  <h3 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-2">
                    Promedio
                  </h3>
                  <div class="flex items-baseline gap-2">
                    @if (averageQuizScore() > 0) {
                      <span class="text-4xl font-bold" [ngClass]="getScoreColor(averageQuizScore())">
                        {{ averageQuizScore().toFixed(1) }}%
                      </span>
                    } @else {
                      <span class="text-4xl font-bold text-gray-500">--</span>
                    }
                  </div>
                  <p class="text-sm text-gray-400 mt-2">En evaluaciones completadas</p>
                </div>
              </div>

              <!-- Filtros -->
              <div class="flex items-center gap-2 flex-wrap">
                <button
                  (click)="filterQuizzes('all')"
                  [class.bg-teal-500]="quizFilter() === 'all'"
                  [class.text-white]="quizFilter() === 'all'"
                  [class.bg-navy-700]="quizFilter() !== 'all'"
                  [class.text-gray-300]="quizFilter() !== 'all'"
                  class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-teal-600"
                >
                  Todas ({{ quizSummaries().length }})
                </button>
                <button
                  (click)="filterQuizzes('pending')"
                  [class.bg-teal-500]="quizFilter() === 'pending'"
                  [class.text-white]="quizFilter() === 'pending'"
                  [class.bg-navy-700]="quizFilter() !== 'pending'"
                  [class.text-gray-300]="quizFilter() !== 'pending'"
                  class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-teal-600"
                >
                  Pendientes ({{ pendingQuizzesCount() }})
                </button>
                <button
                  (click)="filterQuizzes('completed')"
                  [class.bg-teal-500]="quizFilter() === 'completed'"
                  [class.text-white]="quizFilter() === 'completed'"
                  [class.bg-navy-700]="quizFilter() !== 'completed'"
                  [class.text-gray-300]="quizFilter() !== 'completed'"
                  class="px-4 py-2 rounded-lg font-medium transition-colors hover:bg-teal-600"
                >
                  Completadas ({{ completedQuizzesCount() }})
                </button>
              </div>

              <!-- Lista de Evaluaciones -->
              <div class="space-y-4">
                @if (filteredQuizzes().length === 0) {
                  <div class="bg-navy-800/50 p-12 rounded-xl border border-navy-700 text-center">
                    <svg
                      class="w-16 h-16 mx-auto text-gray-600 mb-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z"
                      />
                    </svg>
                    <p class="text-gray-400 text-lg">No hay evaluaciones en esta categor√≠a</p>
                  </div>
                } @else {
                  @for (quiz of filteredQuizzes(); track quiz.id) {
                    <div
                      class="bg-navy-800/50 p-6 rounded-xl border border-navy-700 hover:border-teal-500/30 transition-all group"
                    >
                      <div class="flex items-start justify-between gap-4">
                        <!-- Informaci√≥n Principal -->
                        <div class="flex-1">
                          <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-semibold text-white group-hover:text-teal-400 transition-colors">
                              {{ quiz.title }}
                            </h3>
                            <span
                              class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium"
                              [ngClass]="getQuizStatusBadge(quiz.status)"
                            >
                              <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                              {{ getQuizStatusLabel(quiz.status) }}
                            </span>
                            <span
                              class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium"
                              [ngClass]="getDifficultyBadge(quiz.difficulty)"
                            >
                              {{ getDifficultyLabel(quiz.difficulty) }}
                            </span>
                          </div>

                          <p class="text-sm text-gray-400 mb-3">{{ quiz.moduleName }}</p>

                          <!-- Detalles -->
                          <div class="flex items-center gap-4 text-sm text-gray-400">
                            <span class="flex items-center gap-1.5">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="1.5"
                                  d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
                                />
                              </svg>
                              {{ quiz.totalQuestions }} preguntas
                            </span>
                            <span class="flex items-center gap-1.5">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="1.5"
                                  d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"
                                />
                              </svg>
                              {{ quiz.totalPoints }} puntos
                            </span>
                            @if (quiz.timeLimit) {
                              <span class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"
                                  />
                                </svg>
                                {{ quiz.timeLimit }} min
                              </span>
                            }
                            <span class="flex items-center gap-1.5">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="1.5"
                                  d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
                                />
                              </svg>
                              {{ quiz.attemptsUsed }}/{{ quiz.attemptsAllowed }} intentos
                            </span>
                          </div>

                          <!-- Calificaci√≥n (si existe) -->
                          @if (quiz.bestPercentage !== undefined) {
                            <div class="mt-3 flex items-center gap-3">
                              <div class="flex-1">
                                <div class="flex items-center justify-between text-sm mb-1">
                                  <span class="text-gray-400">Mejor calificaci√≥n</span>
                                  <span class="font-bold" [ngClass]="getScoreColor(quiz.bestPercentage)">
                                    {{ quiz.bestPercentage.toFixed(1) }}%
                                  </span>
                                </div>
                                <div class="h-2 bg-navy-900 rounded-full overflow-hidden">
                                  <div
                                    class="h-full rounded-full transition-all duration-500"
                                    [class.bg-green-500]="quiz.bestPercentage >= 90"
                                    [class.bg-blue-500]="
                                      quiz.bestPercentage >= 75 && quiz.bestPercentage < 90
                                    "
                                    [class.bg-yellow-500]="
                                      quiz.bestPercentage >= 60 && quiz.bestPercentage < 75
                                    "
                                    [class.bg-red-500]="quiz.bestPercentage < 60"
                                    [style.width.%]="quiz.bestPercentage"
                                  ></div>
                                </div>
                              </div>
                              @if (quiz.passed) {
                                <svg class="w-6 h-6 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                                  <path
                                    fill-rule="evenodd"
                                    d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                                    clip-rule="evenodd"
                                  />
                                </svg>
                              }
                            </div>
                          }
                        </div>

                        <!-- Acciones -->
                        <div class="flex flex-col gap-2">
                          @if (quiz.status === 'completed') {
                            <button
                              (click)="viewQuizResults(quiz)"
                              class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors flex items-center gap-2"
                            >
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="1.5"
                                  d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"
                                />
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="1.5"
                                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                />
                              </svg>
                              Ver Resultados
                            </button>
                            @if (quiz.attemptsUsed < quiz.attemptsAllowed) {
                              <button
                                (click)="startQuiz(quiz)"
                                class="px-4 py-2 bg-navy-700 hover:bg-navy-600 text-gray-300 hover:text-white font-semibold rounded-lg transition-colors flex items-center gap-2"
                              >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
                                  />
                                </svg>
                                Reintentar
                              </button>
                            }
                          } @else if (quiz.status === 'expired') {
                            <button
                              disabled
                              class="px-4 py-2 bg-gray-700 text-gray-500 font-semibold rounded-lg cursor-not-allowed"
                            >
                              Vencido
                            </button>
                          } @else {
                            <button
                              (click)="startQuiz(quiz)"
                              class="px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white font-semibold rounded-lg transition-colors flex items-center gap-2"
                            >
                              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                  fill-rule="evenodd"
                                  d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                                  clip-rule="evenodd"
                                />
                              </svg>
                              Iniciar Evaluaci√≥n
                            </button>
                          }
                        </div>
                      </div>
                    </div>
                  }
                }
              </div>
            </div>
          }
        }
      </div>

      <!-- Right Column: Sidebar (4 cols) -->
      <aside class="col-span-12 lg:col-span-4 space-y-8">
        <!-- Progress Card -->
        <div class="gradient-border-card p-6">
          <h3 class="text-lg font-semibold text-white mb-4">Tu Progreso</h3>
          <!-- Circular Progress -->
          <div class="relative w-32 h-32 mx-auto mb-6">
            <svg class="w-full h-full transform -rotate-90">
              <circle
                cx="64"
                cy="64"
                r="56"
                stroke="currentColor"
                stroke-width="12"
                class="text-navy-700"
                fill="none"
              />
              <circle
                cx="64"
                cy="64"
                r="56"
                stroke="currentColor"
                stroke-width="12"
                class="text-teal-500 transition-all duration-1000 ease-out"
                fill="none"
                stroke-dasharray="351.86"
                [attr.stroke-dashoffset]="351.86 - (351.86 * (courseData.progress || 0)) / 100"
                stroke-linecap="round"
              />
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <span class="text-2xl font-bold text-white">{{ courseData.progress }}%</span>
            </div>
          </div>

          <div class="space-y-4">
            <div class="flex justify-between text-sm">
              <span class="text-gray-400">Completado</span>
              <span class="text-white"
                >{{ courseData.completedModules }}/{{ courseData.totalModules }} M√≥dulos</span
              >
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-400">Tiempo restante</span>
              <span class="text-white">~45 horas</span>
            </div>
          </div>
        </div>

        <!-- Instructor Card -->
        <div class="bg-navy-800/50 p-6 rounded-xl border border-navy-700">
          <h3 class="text-lg font-semibold text-white mb-4">Instructor</h3>
          <div class="flex items-center gap-4 mb-4">
            <img
              [src]="courseData.instructor.avatar"
              alt="Instructor"
              class="w-16 h-16 rounded-full border-2 border-teal-500"
            />
            <div>
              <p class="font-bold text-white">{{ courseData.instructor.name }}</p>
              <p class="text-xs text-teal-400 uppercase tracking-wider font-semibold">
                {{ courseData.instructor.title }}
              </p>
            </div>
          </div>
          <p class="text-sm text-gray-400 mb-4 line-clamp-3">
            {{ courseData.instructor.bio }}
          </p>
          <div class="flex gap-2">
            @if (courseData.instructor.socialLinks.twitter) {
              <a
                [href]="courseData.instructor.socialLinks.twitter"
                target="_blank"
                class="p-2 bg-navy-700 rounded-lg hover:bg-teal-500/20 hover:text-teal-400 transition-colors"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"
                  ></path>
                </svg>
              </a>
            }
            @if (courseData.instructor.socialLinks.linkedin) {
              <a
                [href]="courseData.instructor.socialLinks.linkedin"
                target="_blank"
                class="p-2 bg-navy-700 rounded-lg hover:bg-blue-500/20 hover:text-blue-400 transition-colors"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"
                  ></path>
                  <circle cx="4" cy="4" r="2"></circle>
                </svg>
              </a>
            }
            @if (courseData.instructor.socialLinks.website) {
              <a
                [href]="courseData.instructor.socialLinks.website"
                target="_blank"
                class="p-2 bg-navy-700 rounded-lg hover:bg-purple-500/20 hover:text-purple-400 transition-colors"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                  ></path>
                </svg>
              </a>
            }
          </div>
        </div>
      </aside>
    </main>
  } @else {
    <!-- Skeleton Loading State -->
    <div class="animate-pulse">
      <div class="h-64 bg-gray-800"></div>
      <div class="container mx-auto px-4 py-8 grid grid-cols-12 gap-8">
        <div class="col-span-12 lg:col-span-8 space-y-8">
          <div class="h-10 w-full bg-gray-800 rounded-xl"></div>
          <div class="h-40 bg-gray-800 rounded-xl"></div>
          <div class="h-40 bg-gray-800 rounded-xl"></div>
        </div>
        <div class="col-span-12 lg:col-span-4 space-y-8">
          <div class="h-64 bg-gray-800 rounded-xl"></div>
          <div class="h-40 bg-gray-800 rounded-xl"></div>
        </div>
      </div>
    </div>
  }

  <!-- Loading Quiz Modal -->
  @if (loadingQuiz()) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div class="bg-[#0f172a] rounded-2xl shadow-2xl max-w-md w-full p-8 border border-slate-700">
        <div class="text-center">
          <!-- Spinner -->
          <div class="flex justify-center mb-6">
            <div class="relative w-20 h-20">
              <div class="absolute inset-0 border-4 border-teal-500/30 rounded-full"></div>
              <div class="absolute inset-0 border-4 border-transparent border-t-teal-500 rounded-full animate-spin"></div>
            </div>
          </div>
          
          <!-- Loading Text -->
          <h3 class="text-xl font-bold text-white mb-2">Cargando Evaluaci√≥n</h3>
          <p class="text-gray-400 text-sm">Por favor espera mientras preparamos las preguntas...</p>
        </div>
      </div>
    </div>
  }

  <!-- Quiz Take Modal -->
  @if (isQuizActive() && activeQuiz()) {
    <app-quiz-take
      [quiz]="activeQuiz()!"
      (onSubmit)="onQuizSubmit($event)"
      (onCancel)="onQuizCancel()"
    />
  }

  <!-- Quiz Results Modal -->
  @if (isResultsActive() && activeResults()) {
    <app-quiz-results
      [quiz]="activeResults()!.quiz"
      [attempt]="activeResults()!.attempt"
      (onClose)="onResultsClose()"
      (onRetry)="onResultsRetry()"
    />
  }
</div>
